---
title: "DA3_3_paziczki_peter_161117"
author: "Peter Paziczki"
date: "2017 november 16"
output:
  pdf_document: default
  html_document: default
---

<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE, echo=FALSE, warning=FALSE}
# Clearing memory
rm(list=ls())

# Setting global options
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE) ## I don't want to print the code itself, so I set echo to FALSE
```

```{r load}
# Loading necessary libraries
library(ggplot2)
library(data.table)
library(descr) # for the freq function
library(fBasics) # for basicStats function
library(lmtest) # for coeftest
library(sandwich)
library(stargazer)
library(descr)

# Setting presentation parameters
theme_update(plot.title = element_text(hjust = 0.5, size = 12))

# Checking and setting working directory
getwd()
setwd('/Users/User/Documents/R_projects/CEU-DA3')

# Reading input files
share <- read.csv("mortality_oldage_eu.csv", na.strings = ".")
share <- subset(share, age>=50 & age<=80)
share <- subset(share, deceased!="." & female!="." & age!="." & eduyears_mod!="." & income10g!="." & sports!=".")

# Making it a data.table object
share <- data.table(share)

# Dropping the unnecessary columns, keeping only deceased, female, age, eduyears, income10g and sports
share <- share[,c('deceased', 'female', 'age', 'eduyears_mod', 'income10g', 'sports')]

# Frequency tables, deceased = died 
freq(share$deceased)
freq(share$sports)
CrossTable(share$deceased, share$sports) # check the comments before the outputs :)

basicStats(share[,1])
basicStats(share[,2])
basicStats(share[,3])
basicStats(share[,4])
basicStats(share[,5])
basicStats(share[,6])

# Creating binary variables
share$sports_1 <- as.numeric(share$sports == 1)
share$sports_2 <- as.numeric(share$sports == 2)
share$sports_3 <- as.numeric(share$sports == 3)
share$sports_4 <- as.numeric(share$sports == 4)

# Summary statistics of sports binary variables
summary(share$sports_1)
summary(share$sports_2)
summary(share$sports_3)
summary(share$sports_4)
CrossTable(share$deceased, share$sports)

# LPM: linear probability model
lpm1 <- lm(deceased ~ sports, data=share)
lpm2 <- lm(deceased ~ sports_1 + sports_2 + sports_3, data=share)
coeftest(lpm1, vcov=sandwich)
coeftest(lpm2, vcov=sandwich)
```

```{r stargazer}
stargazer(list(lpm1), digits=3, out="sports_mortality_1.html")
stargazer(list(lpm1, lpm2), digits=3, out="sports_mortality_2.html")
```

```{r}
# scatterplot and regression line with smoking only
ggplot(data = share, aes(x=sports, y=deceased)) +
  geom_point(colour="orange") +
  geom_smooth(method="lm", colour="navy") 
# only  regression line with smoking
ggplot(data = share, aes(x=sports, y=deceased)) +
  geom_smooth(method="lm", colour="navy") 
```

# DA3 Assignment #3

### <span style="color:blue"> 1. In this exercise you have to use SHARE data and analyze the pattern of mortality rate with respect to physical activities, in an analysis similar to lecture 5

* Use the SHARE data file mortality_oldage_eu.csv 

* Filter data: Keep respondents between 50 and 80 years of age. The variables you will need are whether the person deceased within 6 years of the interview (“deceased”), gender (“female”), age (“age”), years of education (“eduyears_mod”), income group within country (“income10g), and the explanatory variables of your focus, physical activities (variable “sports”: 1: more than once a week, 2: once a week, 3: one to three times a month, 4: hardly ever, or never).
</span>



### <span style="color:blue"> 2. Do exploratoty analysis: Create binary variables from the sports variable. Describe these variables in your dataset. Drop observations that have missing value for either. 


### <span style="color:blue"> 3. Estimate a linear probability model (LPM) of mortality on sports. Report and interpret the results.




### <span style="color:blue"> 4. If you are interested in the causal effect of doing sports on mortality, would you want to control for some of the other variables in the dataset to get closer to the causal effect you are after? Would that controlling get you the causal effect you are after? 



### <span style="color:blue"> 5. Control for those variables in another LPM, interpret its results on sports, and compare those to the previous regression estimates. Discuss the differences and similarities.




### <span style="color:blue"> 6. Re-do exercises 3 & 5 using logit. Calculate and interpret the marginal differences of the sports variables. Discuss the differences and similarities to the LPM results. 


